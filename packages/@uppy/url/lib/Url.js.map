{"version":3,"names":["h","UIPlugin","RequestClient","toArray","UrlUI","forEachDroppedOrPastedUrl","packageJson","locale","UrlIcon","addProtocolToURL","url","protocolRegex","defaultProtocol","test","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","type","length","checkIfCorrectURL","protocol","match","getFileNameFromUrl","pathname","URL","substring","lastIndexOf","Url","constructor","uppy","opts","id","title","icon","defaultLocale","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","companionCookiesRule","post","then","res","error","log","protocollessUrl","optionalMeta","undefined","info","i18n","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","providerOptions","err","isRestriction","message","details","clipboardData","render","install","target","mount","uninstall","unmount","VERSION","version","prototype"],"sources":["Url.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport { RequestClient } from '@uppy/companion-client'\nimport toArray from '@uppy/utils/lib/toArray'\nimport UrlUI from './UrlUI.jsx'\nimport forEachDroppedOrPastedUrl from './utils/forEachDroppedOrPastedUrl.js'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <rect className=\"uppy-ProviderIconBg\" fill=\"#FF753E\" width=\"32\" height=\"32\" rx=\"16\" />\n        <path d=\"M22.788 15.389l-2.199 2.19a3.184 3.184 0 0 1-.513.437c-.806.584-1.686.876-2.638.876a4.378 4.378 0 0 1-3.519-1.752c-.22-.292-.146-.802.147-1.021.293-.22.806-.146 1.026.146.953 1.313 2.785 1.532 4.105.583a.571.571 0 0 0 .293-.292l2.199-2.189c1.1-1.167 1.1-2.992-.073-4.086a2.976 2.976 0 0 0-4.105 0l-1.246 1.24a.71.71 0 0 1-1.026 0 .703.703 0 0 1 0-1.022l1.246-1.24a4.305 4.305 0 0 1 6.083 0c1.833 1.605 1.906 4.451.22 6.13zm-7.183 5.035l-1.246 1.24a2.976 2.976 0 0 1-4.105 0c-1.172-1.094-1.172-2.991-.073-4.086l2.2-2.19.292-.291c.66-.438 1.393-.657 2.2-.584.805.146 1.465.51 1.905 1.168.22.292.733.365 1.026.146.293-.22.367-.73.147-1.022-.733-.949-1.76-1.532-2.859-1.678-1.1-.22-2.272.073-3.225.802l-.44.438-2.199 2.19c-1.686 1.75-1.612 4.524.074 6.202.88.803 1.979 1.241 3.078 1.241 1.1 0 2.199-.438 3.079-1.24l1.246-1.241a.703.703 0 0 0 0-1.022c-.294-.292-.807-.365-1.1-.073z\" fill=\"#FFF\" fillRule=\"nonzero\" />\n      </g>\n    </svg>\n  )\n}\n\nfunction addProtocolToURL (url) {\n  const protocolRegex = /^[a-z0-9]+:\\/\\//\n  const defaultProtocol = 'http://'\n  if (protocolRegex.test(url)) {\n    return url\n  }\n\n  return defaultProtocol + url\n}\n\nfunction canHandleRootDrop (e) {\n  const items = toArray(e.dataTransfer.items)\n  const urls = items.filter((item) => item.kind === 'string'\n    && item.type === 'text/uri-list')\n  return urls.length > 0\n}\n\nfunction checkIfCorrectURL (url) {\n  if (!url) return false\n\n  const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n  if (protocol !== 'http' && protocol !== 'https') {\n    return false\n  }\n\n  return true\n}\n\nfunction getFileNameFromUrl (url) {\n  const { pathname } = new URL(url)\n  return pathname.substring(pathname.lastIndexOf('/') + 1)\n}\n/**\n * Url\n *\n */\nexport default class Url extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = locale\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  async addFile (protocollessUrl, optionalMeta = undefined) {\n    const url = addProtocolToURL(protocollessUrl)\n    if (!checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return undefined\n    }\n\n    try {\n      const meta = await this.getMeta(url)\n\n      const tagFile = {\n        meta: optionalMeta,\n        source: this.id,\n        name: getFileNameFromUrl(url),\n        type: meta.type,\n        data: {\n          size: meta.size,\n        },\n        isRemote: true,\n        body: {\n          url,\n        },\n        remote: {\n          companionUrl: this.opts.companionUrl,\n          url: `${this.hostname}/url/get`,\n          body: {\n            fileId: url,\n            url,\n          },\n          providerOptions: this.client.opts,\n        },\n      }\n      this.uppy.log('[Url] Adding remote file')\n      try {\n        return this.uppy.addFile(tagFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n        return err\n      }\n    } catch (err) {\n      this.uppy.log(err)\n      this.uppy.info({\n        message: this.i18n('failedToFetch'),\n        details: err,\n      }, 'error', 4000)\n      return err\n    }\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render () {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n\n// This is defined outside of the class body because it's not using `this`, but\n// we still want it available on the prototype so the Dashboard can access it.\nUrl.prototype.canHandleRootDrop = canHandleRootDrop\n"],"mappings":"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"}