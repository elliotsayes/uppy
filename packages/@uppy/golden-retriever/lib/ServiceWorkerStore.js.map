{"version":3,"names":["isSupported","navigator","waitForServiceWorker","Promise","resolve","reject","Error","serviceWorker","controller","addEventListener","ServiceWorkerStore","constructor","opts","ready","name","storeName","list","defer","promise","onMessage","event","data","store","type","files","removeEventListener","then","postMessage","put","file","delete","fileID"],"sources":["ServiceWorkerStore.js"],"sourcesContent":["const isSupported = typeof navigator !== 'undefined' && 'serviceWorker' in navigator\n\nfunction waitForServiceWorker () {\n  return new Promise((resolve, reject) => {\n    if (!isSupported) {\n      reject(new Error('Unsupported'))\n    } else if (navigator.serviceWorker.controller) {\n      // A serviceWorker is already registered and active.\n      resolve()\n    } else {\n      navigator.serviceWorker.addEventListener('controllerchange', () => {\n        resolve()\n      })\n    }\n  })\n}\n\nclass ServiceWorkerStore {\n  constructor (opts) {\n    this.ready = waitForServiceWorker()\n    this.name = opts.storeName\n  }\n\n  list () {\n    const defer = {}\n    const promise = new Promise((resolve, reject) => {\n      defer.resolve = resolve\n      defer.reject = reject\n    })\n\n    const onMessage = (event) => {\n      if (event.data.store !== this.name) {\n        return\n      }\n      switch (event.data.type) {\n        case 'uppy/ALL_FILES':\n          defer.resolve(event.data.files)\n          navigator.serviceWorker.removeEventListener('message', onMessage)\n          break\n        default:\n          defer.reject()\n      }\n    }\n\n    this.ready.then(() => {\n      navigator.serviceWorker.addEventListener('message', onMessage)\n\n      navigator.serviceWorker.controller.postMessage({\n        type: 'uppy/GET_FILES',\n        store: this.name,\n      })\n    })\n\n    return promise\n  }\n\n  put (file) {\n    return this.ready.then(() => {\n      navigator.serviceWorker.controller.postMessage({\n        type: 'uppy/ADD_FILE',\n        store: this.name,\n        file,\n      })\n    })\n  }\n\n  delete (fileID) {\n    return this.ready.then(() => {\n      navigator.serviceWorker.controller.postMessage({\n        type: 'uppy/REMOVE_FILE',\n        store: this.name,\n        fileID,\n      })\n    })\n  }\n}\n\nServiceWorkerStore.isSupported = isSupported\n\nexport default ServiceWorkerStore\n"],"mappings":"AAAA,MAAMA,WAAW,GAAG,OAAOC,SAAP,KAAqB,WAArB,IAAoC,mBAAmBA,SAA3E;;AAEA,SAASC,oBAAT,GAAiC;EAC/B,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACtC,IAAI,CAACL,WAAL,EAAkB;MAChBK,MAAM,CAAC,IAAIC,KAAJ,CAAU,aAAV,CAAD,CAAN;IACD,CAFD,MAEO,IAAIL,SAAS,CAACM,aAAV,CAAwBC,UAA5B,EAAwC;MAC7C;MACAJ,OAAO;IACR,CAHM,MAGA;MACLH,SAAS,CAACM,aAAV,CAAwBE,gBAAxB,CAAyC,kBAAzC,EAA6D,MAAM;QACjEL,OAAO;MACR,CAFD;IAGD;EACF,CAXM,CAAP;AAYD;;AAED,MAAMM,kBAAN,CAAyB;EACvBC,WAAW,CAAEC,IAAF,EAAQ;IACjB,KAAKC,KAAL,GAAaX,oBAAoB,EAAjC;IACA,KAAKY,IAAL,GAAYF,IAAI,CAACG,SAAjB;EACD;;EAEDC,IAAI,GAAI;IACN,MAAMC,KAAK,GAAG,EAAd;IACA,MAAMC,OAAO,GAAG,IAAIf,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;MAC/CY,KAAK,CAACb,OAAN,GAAgBA,OAAhB;MACAa,KAAK,CAACZ,MAAN,GAAeA,MAAf;IACD,CAHe,CAAhB;;IAKA,MAAMc,SAAS,GAAIC,KAAD,IAAW;MAC3B,IAAIA,KAAK,CAACC,IAAN,CAAWC,KAAX,KAAqB,KAAKR,IAA9B,EAAoC;QAClC;MACD;;MACD,QAAQM,KAAK,CAACC,IAAN,CAAWE,IAAnB;QACE,KAAK,gBAAL;UACEN,KAAK,CAACb,OAAN,CAAcgB,KAAK,CAACC,IAAN,CAAWG,KAAzB;UACAvB,SAAS,CAACM,aAAV,CAAwBkB,mBAAxB,CAA4C,SAA5C,EAAuDN,SAAvD;UACA;;QACF;UACEF,KAAK,CAACZ,MAAN;MANJ;IAQD,CAZD;;IAcA,KAAKQ,KAAL,CAAWa,IAAX,CAAgB,MAAM;MACpBzB,SAAS,CAACM,aAAV,CAAwBE,gBAAxB,CAAyC,SAAzC,EAAoDU,SAApD;MAEAlB,SAAS,CAACM,aAAV,CAAwBC,UAAxB,CAAmCmB,WAAnC,CAA+C;QAC7CJ,IAAI,EAAE,gBADuC;QAE7CD,KAAK,EAAE,KAAKR;MAFiC,CAA/C;IAID,CAPD;IASA,OAAOI,OAAP;EACD;;EAEDU,GAAG,CAAEC,IAAF,EAAQ;IACT,OAAO,KAAKhB,KAAL,CAAWa,IAAX,CAAgB,MAAM;MAC3BzB,SAAS,CAACM,aAAV,CAAwBC,UAAxB,CAAmCmB,WAAnC,CAA+C;QAC7CJ,IAAI,EAAE,eADuC;QAE7CD,KAAK,EAAE,KAAKR,IAFiC;QAG7Ce;MAH6C,CAA/C;IAKD,CANM,CAAP;EAOD;;EAEDC,MAAM,CAAEC,MAAF,EAAU;IACd,OAAO,KAAKlB,KAAL,CAAWa,IAAX,CAAgB,MAAM;MAC3BzB,SAAS,CAACM,aAAV,CAAwBC,UAAxB,CAAmCmB,WAAnC,CAA+C;QAC7CJ,IAAI,EAAE,kBADuC;QAE7CD,KAAK,EAAE,KAAKR,IAFiC;QAG7CiB;MAH6C,CAA/C;IAKD,CANM,CAAP;EAOD;;AAzDsB;;AA4DzBrB,kBAAkB,CAACV,WAAnB,GAAiCA,WAAjC;AAEA,eAAeU,kBAAf"}